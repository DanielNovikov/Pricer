@page "/client/login/{token:guid}"

@layout EmptyLayout

<PageTitle>Авторизація | Pricer</PageTitle>

@code {
    [Parameter] public Guid Token { get; set; }

    [Inject] public IAuthenticationService AuthenticationService { get; set; } = default!;

    [Inject] public NavigationManager NavigationManager { get; set; } = default!;

    [Inject] public ProtectedLocalStorage LocalStorage { get; set; } = default!;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        var userId = await AuthenticationService.GetUserId();
        if (userId is not null)
        {
            NavigationManager.NavigateTo("/client/items", true);   
            return;
        }

        var isLoginSucceeded = await AuthenticationService.Login(Token);
        if (!isLoginSucceeded)
        {
            NavigationManager.NavigateTo("/", true);
            return;
        }

        NavigationManager.NavigateTo("/client/items", true);   
    }
}